
# 微服务概览


## 数据库一致性问题

## 多测试环境问题

## 服务依赖问题

## 运维基础依赖

## 核心

ESB? No

组建服务化

kit: 基础库, 框架
service: 业务代码+ 基础库 + 第三方 依赖的业务微服务
rpc + message queue: 轻量级通讯

多个微服务 compose 成一个用户场景

## 组织服务

按业务组织服务
you build it, you fix it.
全栈

大前端 -》 网关接入 =〉业务服务 =》平台服务 =〉基础设施(PaaS/Saas)

## 去中心化

数据库去中心化: 每一个服务 独占一个 数据库

治理去中心化: 服务与服务之前通过rpc来沟通

技术去中心化: 

## 基础设施自动化

CICD: Gitlab + Gitlab Hooks + k8s
Testing: 测试环境 , 单元测试, API自动化测试
运行时: k8s, Prometheus, ELK, Control Panle

## 可用性 & 兼容性设计 (重点)

Design for failure

Batch 调用

采用粗力度的进程间通信

隔离
超时控制
负载保护
限流
降级
重试
负载均衡

发送数据 一定要最小化
接收数据 要开放,保证兼容性


## 微服务设计

### API Gateway

面向用户场景的API

1.0问题:
- 客户端到微服务直接通信,强耦合.(导致无法大规范重构)
- 客户端需要多次请求,客户端聚合数据,工作量巨大,延迟高.
- 前轻后重
- api适配特别麻烦.多终端的兼容
- 统一逻辑无法收敛,如安全认证,限流.

2.0解决: Backend for Frontend
- 需要API网关
- 在服务内进行大量的dataset join
- 设计粗粒度的API
- BFF可以认为是一种适配服务,将后段的服务进行裁剪.是一种数据组装

2.0新的问题:
- API Gateway成了新的 failure 节点

3.0新的解决:
- 按照业务domain 来拆开BFF

4.0新的解决:
- 把业务及集成度高的BFF曾和通用功能服务曾API进行了分层处理.如(Envoy)

## gRPC 服务发现

外部服务 调用内部服务 身份认证方法

内部服务之间的身份认证方法,包括使用证书等

认证完成后,还需要授权,及哪些接口能调用,哪些不能调用

初期不需要过多考虑安全问题.

grpc概念


## 服务发现

推荐使用客户端发现

绝大多数公司不需要service mesh

euerka框架比较好

如果要上线,推荐使用Nacos

## 多集群 & 多用户

大规范发布 如何验证新功能 --》 多租户来解决这个问题

租户是什么.解决了rpc的路由,rpc染色.
通过环境变量,来标示自己.

## 问题答疑

[第一堂课](https://shimo.im/docs/x8dxHkQRcdCHX8j3)

[第二堂课](https://shimo.im/docs/WxJp66WCtjVwKDK3)